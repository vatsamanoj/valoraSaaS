{
  "shouldPost": true,
  "fields": {
    "OrderNumber": { "type": "Text", "label": "Order Number", "required": true, "readonly": true, "isSystem": true },
    "OrderDate": { "type": "Date", "label": "Order Date", "required": true, "defaultValue": "Today", "isSystem": true },
    "CustomerId": { 
        "type": "Lookup", 
        "label": "Customer (GL Account)", 
        "required": true, 
        "isSystem": true,
        "ui": {
            "type": "lookup",
            "lookupModule": "GLAccount",
            "lookupField": "Name",
            "filter": { "Type": 3 }
        }
    },
    "Currency": { "type": "Text", "label": "Currency", "required": true, "defaultValue": "USD", "isSystem": true },
    "TotalAmount": { "type": "Money", "label": "Total Amount", "readonly": true, "isSystem": true },
    "Status": { "type": "Text", "label": "Status", "readonly": true, "isSystem": true },
    
    "ShippingAddress": { "type": "Text", "label": "Shipping Address", "multiline": true, "isSystem": true },
    "BillingAddress": { "type": "Text", "label": "Billing Address", "multiline": true, "isSystem": true },

    "Items": { 
        "type": "Grid", 
        "label": "Order Items",
        "isSystem": true,
        "required": true,
        "columns": [
            { 
                "key": "MaterialCode", 
                "label": "Product", 
                "type": "lookup",
                "lookupModule": "Material",
                "lookupField": "MaterialCode",
                "filter": { },
                "searchStrategy": "wildcard"
            },
            { "key": "Quantity", "label": "Qty", "type": "Number" },
            { "key": "UnitPrice", "label": "Unit Price", "type": "Money" },
            { "key": "LineTotal", "label": "Total", "type": "Money", "readonly": true }
        ]
    },

    "SpecialInstructions": { "type": "Text", "label": "Special Instructions (Custom)", "required": false },
    "Priority": { "type": "Text", "label": "Delivery Priority (Custom)", "required": false, "options": ["High", "Medium", "Low"] }
  },
  "documentTotals": {
    "fields": {
      "subTotal": { "source": "Items", "formula": "SUM(LineTotal)", "label": "Sub-Total" },
      "taxTotal": { "source": "Items", "formula": "SUM(TaxAmount)", "label": "Tax" },
      "totalDiscount": { "source": "Items", "formula": "SUM(DiscountAmount)", "label": "Discount" },
      "netTotal": { "formula": "subTotal + taxTotal - totalDiscount", "label": "Net Total" }
    },
    "displayConfig": {
      "layout": "table",
      "showLabels": true,
      "decimalPlaces": 2
    }
  },
  "calculationRules": {
    "complexCalculation": true,
    "serverSide": {
      "lineItemCalculations": [
        {
          "targetField": "LineTotal",
          "formula": "Quantity * UnitPrice",
          "dependencies": ["Quantity", "UnitPrice"]
        }
      ],
      "documentCalculations": [
        {
          "targetField": "TotalAmount",
          "formula": "SUM(Items.LineTotal)",
          "dependencies": ["Items.LineTotal"]
        }
      ],
      "complexCalculations": [
        {
          "id": "discountCalculation",
          "name": "Volume Discount",
          "formula": "IF(TotalAmount > 1000, TotalAmount * 0.05, 0)",
          "targetField": "DiscountAmount",
          "triggerFields": ["TotalAmount"]
        }
      ]
    }
  },
  "attachmentConfig": {
    "documentLevel": {
      "enabled": true,
      "maxFiles": 10,
      "maxFileSizeMB": 25,
      "allowedTypes": ["pdf", "doc", "docx", "xls", "xlsx", "jpg", "png"],
      "categories": [
        { "id": "contract", "label": "Contract Documents" },
        { "id": "invoice", "label": "Invoices" },
        { "id": "other", "label": "Other Documents" }
      ]
    },
    "lineLevel": {
      "enabled": true,
      "maxFiles": 5,
      "maxFileSizeMB": 10,
      "allowedTypes": ["pdf", "jpg", "png"],
      "gridColumnConfig": {
        "header": "Attachments",
        "width": 100
      }
    }
  },
  "cloudStorage": {
    "providers": [
      {
        "name": "aws-s3",
        "type": "s3",
        "isDefault": true,
        "config": {
          "bucketName": "valora-sales-documents",
          "region": "us-east-1"
        }
      },
      {
        "name": "azure-blob",
        "type": "azure",
        "isDefault": false,
        "config": {
          "accountName": "valorastorage",
          "containerName": "sales-documents"
        }
      }
    ],
    "globalSettings": {
      "encryption": {
        "enabled": true,
        "algorithm": "AES256"
      },
      "lifecycleRules": [
        {
          "prefix": "temp/",
          "expirationDays": 7
        }
      ]
    }
  },
  "ui": {
    "listFields": ["OrderNumber", "OrderDate", "CustomerId", "TotalAmount", "Status", "Priority"],
    "formGroups": [
        { "title": "Order Header", "fields": ["OrderNumber", "OrderDate", "CustomerId", "Currency", "Status"] },
        { "title": "Logistics", "fields": ["ShippingAddress", "BillingAddress", "Priority", "SpecialInstructions"] },
        { "title": "Line Items", "fields": ["Items"] },
        { "title": "Financials", "fields": ["TotalAmount"] }
    ]
  }
}